# ansible-sample-playbook üê∞

–ü—Ä–∏–≤–µ—Ç–∏–∫! –ú–µ–Ω—è –∑–æ–≤—É—Ç Yarustina, –∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –Ø –ø–æ–∫–∞–∂—É —Ç–µ–±–µ —ç—Ç–æ—Ç –º–∏–ª—ã–π Ansible Playbook! üíñ

## ‚ú® –û —á—ë–º —ç—Ç–æ?
–≠—Ç–æ –∫–∞–∫ –≤–æ–ª—à–µ–±–Ω–∞—è –∫–Ω–∏–∂–µ—á–∫–∞, –≥–¥–µ —Å–ø—Ä—è—Ç–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤:
- –¢—É—Ç –µ—Å—Ç—å –ø–∞–ø–æ—á–∫–∏ –¥–ª—è `tasks`, `handlers`, `templates`, `vars` –∏ –¥–∞–∂–µ `secrets`!
- –ü–æ–∫–∞–∂—É, –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–∏–∫–∏ (domain –∏ —Å–ø–∏—Å–æ–∫ IP) –≤ Ansible Vault –∏–ª–∏ –ø—Ä—è–º–æ –≤ vars.
- –í—Å—ë –≥–æ—Ç–æ–≤–æ –ø–æ–¥ —Ç–≤–æ—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É, –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å!

## üîç –ß—Ç–æ –Ω—É–∂–Ω–æ?
- Ansible –≤–µ—Ä—Å–∏–∏ –Ω–µ –º–ª–∞–¥—à–µ 2.9 (—è —Å–µ—Ä—å—ë–∑–Ω–æ!);
- Python –æ—Ç 3.6 –∏–ª–∏ –Ω–æ–≤–µ–µ;
- –î–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç–∞–º –ø–æ SSH (–Ω–µ –∑–∞–±—É–¥—å —Å–≤–æ–∏ –∫–ª—é—á–∏–∫–∏/–ø–∞—Ä–æ–ª—å!);
- –ï—Å–ª–∏ –±—É–¥–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault ‚Äî —Ñ–∞–π–ª —Å –ø–∞—Ä–æ–ª–µ–º –∏–ª–∏ `--ask-vault-pass`.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
.
‚îú‚îÄ‚îÄ handlers/       # —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π (notify)
‚îú‚îÄ‚îÄ tasks/          # —Ç—É—Ç –∂–∏–≤—ë—Ç –æ—Å–Ω–æ–≤–Ω–∞—è –º–∞–≥–∏—è –ø–ª–µ–π–±—É–∫–∞
‚îú‚îÄ‚îÄ templates/      # Jinja2-—à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îú‚îÄ‚îÄ vars/           # –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚îÇ   ‚îî‚îÄ‚îÄ main.yml    # –º–µ—Å—Ç–æ, –∫—É–¥–∞ –º–æ–∂–Ω–æ –ø—Ä—è–º–æ –≤–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ domain –∏ ipset_list
‚îú‚îÄ‚îÄ secrets/        # –º–æ–π –ª–∏—á–Ω—ã–π Vault (–Ω–µ –¥–∞—é –ø–∞—Ä–æ–ª—å ü•≤)
‚îî‚îÄ‚îÄ playbook.yml    # –≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π ‚Äî —Ç–≤–æ–π playbook
```

## üè° –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
–Ø –Ω–µ –∑–Ω–∞—é, –∫–∞–∫–∏–µ —É —Ç–µ–±—è —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É **–∏—Å–ø–æ–ª—å–∑—É–π —Å–≤–æ–π inventory**! üå±
```bash
ansible-playbook \
  -i path/to/your/inventory \
  playbook.yml \
  --ask-vault-pass   # –µ—Å–ª–∏ –±—É–¥–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault
```

## üîê Vault & Override
–í –ø–∞–ø–∫–µ `secrets/` –ª–µ–∂–∏—Ç **–º–æ–π** –ª–∏—á–Ω—ã–π `vault.yml`, –Ω–æ –ø–∞—Ä–æ–ª—å —è –Ω–µ –¥–∞–º üê•

**–í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π Vault**
```bash
cp secrets/vault.yml secrets/my_vault.yml
ansible-vault encrypt secrets/my_vault.yml
```
–ò –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–∞–∫:
```bash
ansible-playbook \
  -i inventory \
  playbook.yml \
  --vault-password-file ~/.vault_pass.txt
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–ø–∏—Å–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `vars/main.yml`**
```yaml
# vars/main.yml
# –í–º–µ—Å—Ç–æ Vault –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—à–∏ –ø—Ä—è–º–æ –∑–¥–µ—Å—å:

domain: example.com       # —Ç–≤–æ–π –¥–æ–º–µ–Ω
ipset_list:               # —Å–ø–∏—Å–æ–∫ IP –¥–ª—è ipset-–ª–∏—Å—Ç–∞
  - 192.168.1.10
  - 10.0.0.0/24
```
–¢–∞–∫ –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault –≤–æ–æ–±—â–µ –∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –±—ã—Ç—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! üîê

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å?
1. –ü–æ–¥–≥–æ—Ç–æ–≤—å —Å–≤–æ–π inventory.
2. –í—ã–±–µ—Ä–∏: Vault –∏–ª–∏ **vars/main.yml**.
3. –í—ã–ø–æ–ª–Ω–∏:
   ```bash
   ansible-playbook \
     -i path/to/your/inventory \
     playbook.yml \
     --ask-vault-pass   # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª —Å–≤–æ–π Vault
   ```

## üêæ –•–æ—á—É –ø–æ–º–æ—á—å!
–ü—Ä–∏—Å—ã–ª–∞–π –∑–≤—ë–∑–¥–æ—á–∫–∏! üåü
